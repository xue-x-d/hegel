<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE sqlMap PUBLIC "-//iBATIS.com//DTD SQL Map 2.0//EN" "sql-map-2.dtd">
<sqlMap namespace="shomopcrm">
	<typeAlias alias="NotifyTrade1"   type="com.shomop.crm.model.notify.NotifyTrade" />
	<typeAlias alias="NotifyItem1"   type="com.shomop.crm.model.notify.NotifyItem" />
	<typeAlias alias="NotifyRefund1"  type="com.shomop.crm.model.notify.NotifyRefund"/>
	<typeAlias alias="NotifyTopats1"  type="com.shomop.crm.model.notify.NotifyTopats"/>
	 <select id="getNotifyTrade" parameterClass="java.util.HashMap" >
		 <![CDATA[
		 	select pubTime as modified,oid,topic,tid,id ,userId from tn_Trade
		 	where dealStatus=0 and topic !=8
		 ]]>
	 	<isNotEmpty prepend="and"  property="modValue" >
		          mod(userid,10) = #modValue#
		</isNotEmpty>
		 <![CDATA[
			order by userId,pubTime limit 9999;
		  ]]>
	 </select>
	 
	 <select id="getNotifyItem"  parameterClass="java.util.HashMap" >
	 		 <![CDATA[
		 	select pubTime as modified,numiid,topic,id ,userId from tn_item
		 	where dealStatus=0
		 	order by userId,pubTime
		 ]]>
	 </select>
	 
	 <select id="getNotifyRefund"  parameterClass="java.util.HashMap" >
	  <![CDATA[
		 	select pubTime as modified,oid,'RefundCreated' as status,tid,id ,userId from tn_Trade
		 	where dealStatus=0  and topic =8
		 	order by userId,modified
		 ]]>
	 </select>
	 <select id="getNotifyTopats"  parameterClass="java.util.HashMap" >
	 	  <![CDATA[
		 	select api_name as topic,taskId,task_Status as taskStatus,pubTime as timestamp,id from tn_Topats
		 	where dealStatus=0
		 	order by timestamp
		 ]]>
	 </select>
	 <update id="updateNotifyTrade"  parameterClass="NotifyTrade1">
		 <![CDATA[
	 		update tn_Trade set dealStatus=#dealStatus#,smsSellerStatus=#smsSellerStatus#,smsBuyerStatus=#smsBuyerStatus#,
	 		dealtime=#dealTime#,dealspend=#dealspend# where id=#id#
	 	 ]]>
	 </update>
	 <update id="updateNotifyRefund"  parameterClass="NotifyRefund1">
		 <![CDATA[
	 		update tn_Trade  set dealStatus=#dealStatus#,smsSellerStatus=#smsSellerStatus#,smsBuyerStatus=#smsBuyerStatus#,
	 		dealtime=#dealTime#,dealspend=#dealspend# where id=#id#
	 	 ]]>
	 </update>
	 <update id="updateNotifyItem"  parameterClass="NotifyItem1">
		 <![CDATA[
	 		update tn_item set dealStatus=#dealStatus#,smsSellerStatus=#smsSellerStatus#,smsBuyerStatus=#smsBuyerStatus#,
	 		dealtime=#dealTime#,dealspend=#dealspend# where id=#id#
	 	 ]]>
	 </update>
	 <update id="updateNotifyTopats"  parameterClass="NotifyTopats1">
		 <![CDATA[
	 		update tn_Topats set dealStatus=#dealStatus#,smsSellerStatus=#smsSellerStatus#,smsBuyerStatus=#smsBuyerStatus#,
	 		dealtime=#dealTime#,dealspend=#dealspend# where id=#id#
	 	 ]]>
	 </update>
</sqlMap>